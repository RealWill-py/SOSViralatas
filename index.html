<!DOCTYPE html>
<html lang="pt-BR" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S.O.S Viralatas by Andrea | Resgate e Ado√ß√£o Premium</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.4s, color 0.4s;
        }
        /* NOVA PALETA DE CORES SUAVES: Rose (Alegria/Fofura) e Sky (Paz/Leveza) */
        /* Modo Escuro Suave (Base: Gray-800) */
        .dark body {
            background-color: #1f2937; 
            color: #f3f4f6; 
        }
        /* Modo Claro Padr√£o (Base: Gray-50) */
        .light body {
            background-color: #f9fafb; 
            color: #111827; 
        }
        /* Estilos base para elementos interativos */
        .input-style {
            transition: border-color 0.3s, box-shadow 0.3s;
            border-radius: 0.5rem; /* rounded-lg */
        }
        .input-style:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(251, 113, 133, 0.5); /* Rose-400 shadow */
        }
        
        /* Estilo da anima√ß√£o do Easter Egg */
        .cat-dog-animation {
            position: absolute;
            top: 50%;
            height: 60px; 
            font-size: 48px; 
            white-space: nowrap;
            animation: move-across-reverse 4s linear forwards;
            transform: translateY(-50%) translateX(100%); 
        }

        @keyframes move-across-reverse {
            0% {
                transform: translateY(-50%) translateX(100vw); 
            }
            100% {
                transform: translateY(-50%) translateX(-100%); 
            }
        }
    </style>
    <script type="module" src="https://unpkg.com/lucide@latest"></script>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üíñ</text></svg>">
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, doc, addDoc, setDoc, updateDoc, getDoc, deleteDoc, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Configura√ß√µes e Vari√°veis Globais (Dispon√≠veis no ambiente Canvas)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        // Inicializa√ß√£o do Firebase
        let app, db, auth;
        try {
            app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            auth = getAuth(app);
            setLogLevel('Debug');
            console.log("Firebase inicializado.");
        } catch(e) {
            console.error("Erro ao inicializar Firebase:", e);
        }

        let userId = null;
        let isAdminLoggedIn = false; 
        
        // Define um ID fixo para o documento de credenciais
        const ADMIN_CREDENTIALS_ID = 'credentials_config'; 
        
        // --- Caminhos do Firestore ---
        const ANIMALS_COLLECTION_PATH = `artifacts/${appId}/public/data/animais_resgatados`;
        const ADOPTION_INTERESTS_PATH = `artifacts/${appId}/public/data/adoption_interests`; // Novo!
        const ADMIN_CONFIG_DOC_PATH = `artifacts/${appId}/users/${ADMIN_CREDENTIALS_ID}/config/admin_credentials`;
        const PUBLIC_CONFIG_DOC_PATH = `artifacts/${appId}/public/data/app_config/main_data`;
        const APP_STATUS_DOC_PATH = `artifacts/${appId}/public/data/app_status/main_status`; // Novo!

        // Estados Locais (Cache)
        let adminCredentials = { username: 'admin', password: '1234' }; 
        let appConfig = { email: 'contato@sosviralatas.org', telefone: '(XX) 9XXXX-XXXX', instagram: '@sosviralatas', mapsLink: 'https://maps.app.goo.gl/exemplo' }; 
        let appStatus = { resgatados_count: 0, adotados_count: 0, aguardando_doacao_count: 0, site_views_count: 0, presentation_text: 'Bem-vindos ao S.O.S Viralatas by Andrea! Nossa miss√£o √© dar uma segunda chance a c√£es e gatos resgatados, encontrando lares amorosos para eles.' }; // Novo!
        let animalsList = []; // Cache da lista de animais
        let interestsList = []; // Cache da lista de interessados

        // Elementos da UI
        const adminSection = document.getElementById('admin-section');
        const publicSection = document.getElementById('public-section');
        const loginSection = document.getElementById('login-section');
        const animalsListPublic = document.getElementById('animals-list-public');
        const presentationTextElement = document.getElementById('presentation-text'); // Novo!
        const adminToggleBtn = document.getElementById('toggle-admin');
        const themeToggleBtn = document.getElementById('theme-toggle');
        const headerElement = document.getElementById('main-header'); 
        
        // Estado da Admin View
        let currentAdminView = 'dashboard'; // 'dashboard', 'animals', 'config'

        // Vari√°vel para o Easter Egg
        let themeToggleClickCount = 0;
        const EASTER_EGG_LIMIT = 13;


        // --- 0. Fun√ß√µes de Configura√ß√£o Inicial e Credenciais ---

        /** Inicializa e carrega as credenciais e a configura√ß√£o p√∫blica/status. */
        async function initializeConfigs() {
            if (!db) return;

            // 1. Credenciais Admin (Privadas) - Apenas tenta ler/escrever
            try {
                const adminDocRef = doc(db, ADMIN_CONFIG_DOC_PATH);
                const adminDocSnap = await getDoc(adminDocRef);
                if (adminDocSnap.exists()) {
                    adminCredentials = adminDocSnap.data();
                } else {
                    await setDoc(adminDocRef, adminCredentials);
                }
            } catch (error) {
                console.warn("AVISO: Falha ao carregar/inicializar credenciais de Admin. Usando cache local.", error);
            }
            
            // 2. Configura√ß√£o P√∫blica (Contatos, Mapa) - Apenas tenta ler/escrever
            try {
                const publicDocRef = doc(db, PUBLIC_CONFIG_DOC_PATH);
                const publicDocSnap = await getDoc(publicDocRef);
                if (publicDocSnap.exists()) {
                    appConfig = publicDocSnap.data();
                } else {
                    await setDoc(publicDocRef, appConfig);
                }
            } catch (error) {
                console.error("Erro ao carregar/inicializar Configura√ß√£o P√∫blica:", error);
            }
            
            // 3. Status da Aplica√ß√£o (Contadores, Texto) - Apenas tenta ler/escrever e INCREMENTAR VIEW
            try {
                const statusDocRef = doc(db, APP_STATUS_DOC_PATH);
                const statusDocSnap = await getDoc(statusDocRef);
                
                if (statusDocSnap.exists()) {
                    const data = statusDocSnap.data();
                    appStatus = data;
                    
                    // Incrementa o contador de visitas (Se n√£o for admin)
                    if (!isAdminLoggedIn) {
                        const newViews = (data.site_views_count || 0) + 1;
                        await updateDoc(statusDocRef, { site_views_count: newViews });
                        appStatus.site_views_count = newViews; // Atualiza cache
                    }
                } else {
                    appStatus.site_views_count = 1; // Primeira visita
                    await setDoc(statusDocRef, appStatus);
                }
            } catch (error) {
                console.error("Erro ao carregar/incrementar status da Aplica√ß√£o:", error);
            }
        }

        // --- 1. Fun√ß√µes de Layout e Estado ---

        /** Alterna entre modo escuro e claro E gerencia o Easter Egg */
        themeToggleBtn.addEventListener('click', () => {
            // 1. L√≥gica do Tema
            document.documentElement.classList.toggle('dark');
            const isDark = document.documentElement.classList.contains('dark');
            themeToggleBtn.innerHTML = isDark 
                ? '<i data-lucide="sun" class="w-6 h-6 text-rose-400"></i>' 
                : '<i data-lucide="moon" class="w-6 h-6 text-gray-800"></i>';
            lucide.createIcons();

            // 2. L√≥gica do Easter Egg
            themeToggleClickCount++;
            if (themeToggleClickCount >= EASTER_EGG_LIMIT) {
                themeToggleClickCount = 0; 
                triggerEasterEgg();
            }
        });
        
        // CORRE√á√ÉO: Listener para alternar a visualiza√ß√£o entre P√∫blico e Login/Admin
        adminToggleBtn.addEventListener('click', () => {
            // Se estivermos na tela p√∫blica (bot√£o com √≠cone de 'settings')
            if (publicSection.classList.contains('hidden') === false) {
                setView('login'); // Abre a tela de login
            } 
            // Se estivermos na tela de login ou admin (bot√£o com √≠cone de 'x')
            else {
                // Se estiver logado, faz logout (usando o clique do bot√£o de logout)
                if (isAdminLoggedIn) {
                    document.getElementById('logout-admin').click(); // Chama a fun√ß√£o de logout
                } else {
                    setView('public'); // Volta para a tela p√∫blica
                }
            }
        });


        /** Ativa a anima√ß√£o do gato e do c√£o */
        function triggerEasterEgg() {
            if (!headerElement) return;

            const animationElement = document.createElement('div');
            animationElement.className = 'cat-dog-animation'; 
            animationElement.innerHTML = 'üêàüêï'; 
            
            headerElement.appendChild(animationElement);

            setTimeout(() => {
                animationElement.remove();
            }, 4100);
        }

        /** * Gerencia a visibilidade das se√ß√µes principais
         * @param {string} view 'public', 'login', ou 'admin'
         */
        function setView(view) {
            publicSection.classList.add('hidden');
            loginSection.classList.add('hidden');
            adminSection.classList.add('hidden');

            adminToggleBtn.classList.remove('bg-rose-400', 'text-gray-800', 'hover:bg-rose-500'); 
            adminToggleBtn.classList.remove('bg-red-500', 'text-white', 'hover:bg-red-600');
            
            if (view === 'public') {
                publicSection.classList.remove('hidden');
                adminToggleBtn.innerHTML = '<i data-lucide="settings" class="w-6 h-6"></i>';
                adminToggleBtn.classList.add('bg-rose-400', 'text-gray-800', 'hover:bg-rose-500'); 
            } else {
                adminToggleBtn.innerHTML = '<i data-lucide="x" class="w-6 h-6"></i>';
                adminToggleBtn.classList.add('bg-red-500', 'text-white', 'hover:bg-red-600');

                if (view === 'login') {
                    loginSection.classList.remove('hidden');
                } else if (view === 'admin') {
                    adminSection.classList.remove('hidden');
                    // Garante que a dashboard seja a view padr√£o ao logar
                    setAdminView(currentAdminView); 
                    document.getElementById('current-user-id').textContent = userId;
                }
            }

            lucide.createIcons();
        }

        /** * Gerencia a visibilidade dos blocos da √°rea admin
         * @param {string} view 'dashboard', 'animals', ou 'config'
         */
        function setAdminView(view) {
            currentAdminView = view;
            const views = {
                dashboard: document.getElementById('admin-dashboard-block'),
                animals: document.getElementById('admin-animals-block'),
                config: document.getElementById('admin-config-block')
            };

            document.querySelectorAll('#admin-nav button').forEach(btn => {
                if (btn.dataset.view === view) {
                    btn.classList.add('bg-sky-500', 'text-white');
                    btn.classList.remove('bg-gray-200', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
                } else {
                    btn.classList.remove('bg-sky-500', 'text-white');
                    btn.classList.add('bg-gray-200', 'dark:bg-gray-700', 'text-gray-800', 'dark:text-gray-200');
                }
            });

            for (const key in views) {
                views[key].classList.add('hidden');
            }
            views[view].classList.remove('hidden');

            // A√ß√µes espec√≠ficas ao mudar de view
            if (view === 'config') {
                populateGlobalConfigForm();
                populateManagedCountersForm();
            }
        }

        // Listener para a navega√ß√£o Admin
        document.querySelectorAll('#admin-nav button').forEach(btn => {
            btn.addEventListener('click', () => setAdminView(btn.dataset.view));
        });


        // --- 2. Autentica√ß√£o e Configura√ß√£o Inicial ---

        async function initialAuthAndSetup() {
            if (!auth || !db) return;
            
            // 1. Tenta autenticar
            try {
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (error) {
                console.error("Erro durante a autentica√ß√£o inicial:", error);
            }

            // 2. Espera pelo estado de autentica√ß√£o e configura o listener principal
            onAuthStateChanged(auth, async (user) => {
                userId = user ? user.uid : null;
                
                // 3. Garante que todas as configura√ß√µes (Admin, P√∫blicas, Status) sejam carregadas E view incrementada
                await initializeConfigs();

                // 4. Configura os listeners do Firestore AP√ìS a autentica√ß√£o
                setupAnimalsListener();
                setupAppStatusListener(); // Novo listener
                setupAdoptionInterestsListener(); // Novo listener
                renderPublicConfig(); 
                
                // Define a view inicial
                if (isAdminLoggedIn) {
                    setView('admin');
                } else {
                    setView('public');
                }
            });
        }
        
        // --- 2.1 Login Admin e Logout ---
        document.getElementById('admin-login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const usernameInput = e.target.username.value;
            const passwordInput = e.target.password.value;
            const loginErrorMessage = document.getElementById('login-error-message');
            
            loginErrorMessage.textContent = '';
            
            await initializeConfigs(); // Recarrega as credenciais mais recentes

            if (usernameInput !== adminCredentials.username || passwordInput !== adminCredentials.password) {
                 loginErrorMessage.textContent = 'Credenciais incorretas.';
                 return;
            }

            isAdminLoggedIn = true; 
            showModal("Bem-vindo, Andrea!", "Login de administra√ß√£o realizado com sucesso.");
            setView('admin'); 
        });

        document.getElementById('logout-admin').addEventListener('click', async () => {
            isAdminLoggedIn = false; 
            showModal("Sess√£o Encerrada", "Voc√™ saiu da √°rea administrativa.");
            setView('public'); 
        });


        // --- 3. Listener do Status da Aplica√ß√£o (Contadores e Texto de Apresenta√ß√£o) ---

        function setupAppStatusListener() {
            if (!db) return;
            try {
                const statusDocRef = doc(db, APP_STATUS_DOC_PATH);
                onSnapshot(statusDocRef, (docSnap) => {
                    if (docSnap.exists()) {
                        appStatus = docSnap.data();
                    } else {
                        // Se o documento n√£o existir, usa o status inicial
                        appStatus = { resgatados_count: 0, adotados_count: 0, aguardando_doacao_count: 0, site_views_count: 0, presentation_text: 'Bem-vindos...' };
                    }
                    renderPublicStatus(); // Atualiza a apresenta√ß√£o p√∫blica e contadores
                    renderAdminIndicators(); // Atualiza contadores no topo do Admin
                }, (error) => {
                    console.error("Erro ao buscar status da aplica√ß√£o:", error);
                });
            } catch(e) {
                console.error("Erro ao configurar onSnapshot para App Status:", e);
            }
        }

        /** Renderiza o texto de apresenta√ß√£o e os contadores na p√°gina p√∫blica. */
        function renderPublicStatus() {
            // Renderiza o texto de apresenta√ß√£o
            presentationTextElement.textContent = appStatus.presentation_text;

            // Renderiza os contadores p√∫blicos
            document.getElementById('resgatados-count').textContent = appStatus.resgatados_count || 0;
            document.getElementById('adotados-count').textContent = appStatus.adotados_count || 0;
            document.getElementById('doacao-count').textContent = appStatus.aguardando_doacao_count || 0;
        }

        /** Renderiza os indicadores no topo do Painel Admin. */
        function renderAdminIndicators() {
            document.getElementById('admin-views-count').textContent = appStatus.site_views_count || 0;
            document.getElementById('admin-available-animals').textContent = animalsList.length; // Usa o cache da lista de animais
        }


        // --- 4. Gerenciamento dos Contadores na Admin Config ---

        /** Popula o formul√°rio de contadores gerenciados com dados atuais */
        function populateManagedCountersForm() {
            const form = document.getElementById('managed-counters-form');
            if (form) {
                form.querySelector('#resgatados').value = appStatus.resgatados_count || 0;
                form.querySelector('#adotados').value = appStatus.adotados_count || 0;
                form.querySelector('#aguardando').value = appStatus.aguardando_doacao_count || 0;
            }
        }

        document.getElementById('managed-counters-form').addEventListener('submit', async (e) => {
            e.preventDefault();
             if (!isAdminLoggedIn || !db) { showModal("Acesso Negado", "Admin necess√°rio."); return; }

            const newCounts = {
                resgatados_count: parseInt(e.target.resgatados.value) || 0,
                adotados_count: parseInt(e.target.adotados.value) || 0,
                aguardando_doacao_count: parseInt(e.target.aguardando.value) || 0
            };

            try {
                const statusDocRef = doc(db, APP_STATUS_DOC_PATH);
                await updateDoc(statusDocRef, newCounts);
                showModal("Sucesso", "Contadores de Resgate/Ado√ß√£o atualizados!");
            } catch (error) {
                console.error("Erro ao salvar contadores:", error);
                showModal("Erro", `N√£o foi poss√≠vel salvar os contadores. Detalhes: ${error.message}.`);
            }
        });


        // --- 5. Gerenciamento do Formul√°rio de Interesse em Ado√ß√£o ---

        const adoptionInterestForm = document.getElementById('adoption-interest-form');

        /** Abre o modal de interesse em ado√ß√£o. */
        function openAdoptionModal(animalId, animalName) {
            document.getElementById('interest-animal-name').textContent = animalName;
            adoptionInterestForm.dataset.animalId = animalId;
            adoptionInterestForm.dataset.animalName = animalName;
            document.getElementById('adoption-modal').classList.remove('hidden');
            document.getElementById('adoption-interest-error').textContent = '';
        }

        /** Fecha o modal de interesse. */
        document.getElementById('adoption-modal-close').addEventListener('click', () => {
            document.getElementById('adoption-modal').classList.add('hidden');
            adoptionInterestForm.reset();
        });

        adoptionInterestForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const animalId = adoptionInterestForm.dataset.animalId;
            const animalName = adoptionInterestForm.dataset.animalName;
            
            const data = {
                nome: e.target.interestName.value.trim(),
                telefone: e.target.interestPhone.value.trim(),
                email: e.target.interestEmail.value.trim() || 'N√£o fornecido',
                dataSubmissao: Date.now(),
                animalId: animalId,
                animalNome: animalName
            };
            
            const errorElement = document.getElementById('adoption-interest-error');
            errorElement.textContent = '';

            if (!data.nome || !data.telefone) {
                errorElement.textContent = 'Nome e Telefone s√£o campos obrigat√≥rios.';
                return;
            }

            try {
                await addDoc(collection(db, ADOPTION_INTERESTS_PATH), data);
                showModal("Obrigado!", `Seu interesse em ${animalName} foi registrado! Entraremos em contato em breve.`);
                document.getElementById('adoption-modal').classList.add('hidden');
                adoptionInterestForm.reset();
            } catch (error) {
                console.error("Erro ao registrar interesse:", error);
                showModal("Erro", `N√£o foi poss√≠vel registrar seu interesse. Tente novamente mais tarde.`);
            }
        });

        // --- 6. Listener para a Lista de Interessados em Ado√ß√£o ---

        function setupAdoptionInterestsListener() {
            if (!db) return;
            try {
                const interestsCollectionRef = collection(db, ADOPTION_INTERESTS_PATH);
                const q = query(interestsCollectionRef, orderBy('dataSubmissao', 'desc'));
                
                onSnapshot(q, (snapshot) => {
                    interestsList = [];
                    snapshot.forEach(doc => {
                        interestsList.push({ id: doc.id, ...doc.data() });
                    });
                    renderInterestsListAdmin(interestsList);
                }, (error) => {
                    console.error("Erro ao buscar lista de interessados:", error);
                });
            } catch(e) {
                console.error("Erro ao configurar onSnapshot para Interessados:", e);
            }
        }

        /** Renderiza a lista de interessados na Dashboard Admin. */
        function renderInterestsListAdmin(list) {
            const container = document.getElementById('adoption-interests-list');
            container.innerHTML = '';

            if (list.length === 0) {
                container.innerHTML = '<p class="text-center text-gray-500 dark:text-gray-400 p-4">Nenhum interessado registrado ainda. üíñ</p>';
                document.getElementById('interests-count').textContent = 0;
                return;
            }
            
            document.getElementById('interests-count').textContent = list.length;
            
            list.forEach(item => {
                const itemDate = new Date(item.dataSubmissao).toLocaleDateString('pt-BR');
                const listItem = document.createElement('li');
                listItem.className = 'bg-white dark:bg-gray-700 p-4 rounded-lg shadow border border-sky-100 dark:border-sky-800 flex justify-between items-center mb-2';
                listItem.innerHTML = `
                    <div>
                        <p class="font-bold text-lg text-rose-500">${item.nome} (${itemDate})</p>
                        <p class="text-sm text-gray-600 dark:text-gray-300">Animal: <span class="font-semibold">${item.animalNome}</span></p>
                        <p class="text-sm text-gray-600 dark:text-gray-300">üìû ${item.telefone}</p>
                        <p class="text-xs text-gray-500 dark:text-gray-400">üìß ${item.email}</p>
                    </div>
                    <button data-id="${item.id}" data-action="delete-interest" class="delete-interest-btn bg-red-500 hover:bg-red-600 text-white p-2 rounded-full transition-colors flex items-center space-x-1 shadow-md">
                        <i data-lucide="check" class="w-4 h-4"></i>
                    </button>
                `;
                container.appendChild(listItem);
            });
            lucide.createIcons();
        }
        
        // Listener para deletar interesse (marcar como lido)
        document.getElementById('adoption-interests-list').addEventListener('click', async (e) => {
            const btn = e.target.closest('.delete-interest-btn');
            if (btn) {
                const id = btn.dataset.id;
                const listItem = btn.closest('li');

                const isConfirmed = await showConfirmModal("Marcar como Tratado", "Marcar este interesse como tratado e remover da lista?");
                
                if (!isConfirmed) return;

                try {
                    const interestRef = doc(db, ADOPTION_INTERESTS_PATH, id);
                    await deleteDoc(interestRef);
                    showModal("Sucesso", "Interesse removido da lista.");
                } catch (error) {
                    console.error("Erro ao deletar interesse:", error);
                    showModal("Erro", `N√£o foi poss√≠vel remover. Detalhes: ${error.message}.`);
                }
            }
        });


        // --- 7. CRUD de Animais (Atualiza√ß√£o de Cores e Cache) ---

        /** Configura o listener em tempo real para a cole√ß√£o de animais (Public). */
        function setupAnimalsListener() {
            if (!db) return;
            try {
                const animalsCollectionRef = collection(db, ANIMALS_COLLECTION_PATH);
                onSnapshot(animalsCollectionRef, (snapshot) => {
                    animalsList = [];
                    snapshot.forEach(doc => {
                        animalsList.push({ id: doc.id, ...doc.data() });
                    });
                    
                    animalsList.sort((a, b) => (b.dataCriacao || 0) - (a.dataCriacao || 0));

                    renderAnimals(animalsList, isAdminLoggedIn); 
                    renderAdminIndicators(); // Atualiza contagem de animais no topo admin
                }, (error) => {
                    console.error("Erro ao buscar dados do Firestore:", error);
                     animalsListPublic.innerHTML = '<p class="text-center text-red-500 p-4">Erro ao carregar dados. Verifique as permiss√µes de leitura no Firestore.</p>';
                });
            } catch(e) {
                console.error("Erro ao tentar configurar onSnapshot:", e);
            }
        }
        
        /** Renderiza as listas de animais na √°rea p√∫blica e administrativa. */
        function renderAnimals(animals, isAdminView) {
            document.getElementById('animals-list-admin').innerHTML = '';
            animalsListPublic.innerHTML = '';

            if (animals.length === 0) {
                animalsListPublic.innerHTML = '<p class="text-center text-gray-500 dark:text-gray-400 p-4">Nenhum animal resgatado cadastrado ainda. üêæ</p>';
                document.getElementById('animals-list-admin').innerHTML = '<li class="text-gray-500 dark:text-gray-400 p-4">A lista est√° vazia. Adicione um novo animal acima!</li>';
                return;
            }

            // Renderiza na √Årea P√∫blica (Landing Page)
            animals.slice(0, 6).forEach(animal => { // Mostra apenas os 6 mais recentes
                const card = createAnimalCard(animal, false);
                animalsListPublic.appendChild(card);
            });

            // Renderiza na √Årea Administrativa (Se logado)
            if (isAdminView) {
                animals.forEach(animal => {
                    const listItem = createAnimalCard(animal, true);
                    document.getElementById('animals-list-admin').appendChild(listItem);
                });
            }
        }

        /** Cria o card/item de animal. */
        function createAnimalCard(animal, isAdmin) {
            const container = document.createElement(isAdmin ? 'li' : 'div');
            container.className = isAdmin 
                ? 'bg-white dark:bg-gray-800 p-4 rounded-xl shadow-lg flex flex-col md:flex-row items-center space-y-3 md:space-y-0 md:space-x-4 mb-4 transition-colors border border-gray-200 dark:border-gray-700' 
                : 'bg-white dark:bg-gray-800 rounded-2xl shadow-2xl overflow-hidden transform hover:scale-[1.02] transition-all duration-300 border border-rose-100 dark:border-rose-900';
            
            // Placeholder usa a nova cor Rose
            const imageUrl = animal.imagemUrl && animal.imagemUrl.startsWith('http') 
                ? animal.imagemUrl 
                : `https://placehold.co/400x300/F472B6/FFFFFF?text=üêæ+${animal.nome}`; /* Pink/Rose */

            if (isAdmin) {
                container.innerHTML = `
                    <img src="${imageUrl}" onerror="this.onerror=null;this.src='https://placehold.co/64x64/F472B6/FFFFFF?text=üêæ';" alt="Foto de ${animal.nome}" class="w-16 h-16 object-cover rounded-full flex-shrink-0 border-2 border-rose-400">
                    <div class="flex-grow min-w-0">
                        <h3 class="text-xl font-bold text-sky-600 dark:text-sky-400 truncate">${animal.nome}</h3>
                        <p class="text-sm text-gray-600 dark:text-gray-300">${animal.raca} - ${animal.idade} ano(s)</p>
                    </div>
                    <div class="flex space-x-2 mt-3 md:mt-0 flex-shrink-0">
                        <button data-id="${animal.id}" data-action="edit" class="edit-btn bg-sky-400 hover:bg-sky-500 text-gray-800 p-2 rounded-lg text-sm transition-colors flex items-center space-x-1 shadow-md">
                            <i data-lucide="pencil" class="w-4 h-4"></i>
                        </button>
                        <button data-id="${animal.id}" data-action="delete" class="delete-btn bg-red-500 hover:bg-red-600 text-white p-2 rounded-lg text-sm transition-colors flex items-center space-x-1 shadow-md">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                        </button>
                    </div>
                `;
                container.querySelector('.edit-btn').addEventListener('click', () => editAnimal(animal));
                container.querySelector('.delete-btn').addEventListener('click', () => deleteAnimal(animal.id, animal.nome));
            } else {
                container.innerHTML = `
                    <img src="${imageUrl}" onerror="this.onerror=null;this.src='https://placehold.co/400x300/F472B6/FFFFFF?text=S.O.S+Viralatas';" alt="Foto de ${animal.nome}" class="w-full h-48 object-cover">
                    <div class="p-5">
                        <h3 class="text-2xl font-extrabold text-sky-600 dark:text-sky-400 mb-1">${animal.nome}</h3>
                        <p class="text-base text-gray-700 dark:text-gray-300 font-medium">${animal.raca} | ${animal.idade} ano(s)</p>
                        <p class="text-sm text-gray-600 dark:text-gray-400 mt-3 line-clamp-3">${animal.descricao}</p>
                        <button data-id="${animal.id}" data-name="${animal.nome}" class="adoption-interest-btn mt-5 w-full bg-rose-400 text-gray-800 py-3 rounded-xl hover:bg-rose-500 transition-colors font-bold shadow-xl flex items-center justify-center space-x-2">
                             <i data-lucide="heart" class="w-5 h-5 fill-rose-600 text-rose-600"></i>
                            <span>Adote ${animal.nome}</span>
                        </button>
                    </div>
                `;
                container.querySelector('.adoption-interest-btn').addEventListener('click', (e) => {
                    openAdoptionModal(e.currentTarget.dataset.id, e.currentTarget.dataset.name);
                });
            }

            lucide.createIcons();
            return container;
        }

        // --- 8. CRUD Adicionar/Editar/Deletar Animal ---

        const animalForm = document.getElementById('animal-form');
        let isEditing = false;
        let currentAnimalId = null;

        /** Limpa o formul√°rio e prepara para adicionar. */
        function resetAnimalForm() {
            isEditing = false;
            currentAnimalId = null;
            animalForm.reset();
            document.getElementById('animal-form-title').textContent = 'Adicionar Novo Animal';
            document.getElementById('submit-animal-btn').textContent = 'Adicionar ao Resgate';
            document.getElementById('cancel-edit-btn').classList.add('hidden');
        }

        /** Prepara o formul√°rio para edi√ß√£o. */
        function editAnimal(animal) {
            isEditing = true;
            currentAnimalId = animal.id;
            
            document.getElementById('animal-form-title').textContent = `Editar ${animal.nome}`;
            document.getElementById('submit-animal-btn').textContent = 'Salvar Altera√ß√µes';
            document.getElementById('cancel-edit-btn').classList.remove('hidden');

            animalForm.nome.value = animal.nome;
            animalForm.raca.value = animal.raca;
            animalForm.idade.value = animal.idade;
            animalForm.descricao.value = animal.descricao;
            animalForm.imagemUrl.value = animal.imagemUrl || '';

            // Rola para o formul√°rio
            document.getElementById('admin-animals-block').scrollIntoView({ behavior: 'smooth' });
        }

        /** Deleta um animal. */
        async function deleteAnimal(id, nome) {
            if (!isAdminLoggedIn || !db) { showModal("Acesso Negado", "Admin necess√°rio."); return; }
            
            const isConfirmed = await showConfirmModal("Confirmar Exclus√£o", `Tem certeza que deseja remover ${nome} da lista de resgatados?`);
            
            if (!isConfirmed) return;

            try {
                const animalDocRef = doc(db, ANIMALS_COLLECTION_PATH, id);
                await deleteDoc(animalDocRef);
                showModal("Sucesso", `${nome} foi removido com sucesso.`);
            } catch (error) {
                console.error("Erro ao deletar animal:", error);
                showModal("Erro", `N√£o foi poss√≠vel deletar ${nome}. Detalhes: ${error.message}.`);
            }
        }

        // Listener de envio do formul√°rio de animal
        animalForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!isAdminLoggedIn || !db) { showModal("Acesso Negado", "Admin necess√°rio."); return; }

            const animalData = {
                nome: e.target.nome.value.trim(),
                raca: e.target.raca.value.trim(),
                idade: parseInt(e.target.idade.value) || 1,
                descricao: e.target.descricao.value.trim(),
                imagemUrl: e.target.imagemUrl.value.trim(),
                dataCriacao: Date.now() 
            };
            
            // Valida√ß√£o b√°sica
            if (!animalData.nome || !animalData.raca || !animalData.descricao) {
                showModal("Aten√ß√£o", "Por favor, preencha Nome, Ra√ßa e Descri√ß√£o.");
                return;
            }

            try {
                if (isEditing && currentAnimalId) {
                    const animalDocRef = doc(db, ANIMALS_COLLECTION_PATH, currentAnimalId);
                    await updateDoc(animalDocRef, animalData);
                    showModal("Sucesso", `${animalData.nome} foi atualizado com sucesso!`);
                } else {
                    await addDoc(collection(db, ANIMALS_COLLECTION_PATH), animalData);
                    showModal("Sucesso", `${animalData.nome} foi adicionado aos resgatados!`);
                }
                
                resetAnimalForm();
            } catch (error) {
                console.error("Erro ao salvar animal:", error);
                showModal("Erro", `N√£o foi poss√≠vel salvar os dados. Detalhes: ${error.message}.`);
            }
        });

        // Listener do bot√£o de Cancelar Edi√ß√£o
        document.getElementById('cancel-edit-btn').addEventListener('click', resetAnimalForm);


        // --- 9. Gerenciamento de Configura√ß√£o Global (Contatos e Admin) ---

        /** Renderiza o bloco de contatos na √°rea p√∫blica. */
        function renderPublicConfig() {
            document.getElementById('contact-email').textContent = appConfig.email;
            document.getElementById('contact-phone').textContent = appConfig.telefone;
            document.getElementById('contact-instagram').textContent = appConfig.instagram;
            document.getElementById('map-link').href = appConfig.mapsLink;
        }

        /** Popula o formul√°rio de configura√ß√£o global. */
        function populateGlobalConfigForm() {
            const form = document.getElementById('global-config-form');
            if (form) {
                form.querySelector('#config-email').value = appConfig.email;
                form.querySelector('#config-phone').value = appConfig.telefone;
                form.querySelector('#config-instagram').value = appConfig.instagram;
                form.querySelector('#config-maps-link').value = appConfig.mapsLink;
                form.querySelector('#presentation-text-area').value = appStatus.presentation_text;
            }
        }
        
        /** Popula o formul√°rio de credenciais admin. */
        function populateAdminCredentialsForm() {
            const form = document.getElementById('admin-credentials-form');
            if (form) {
                form.querySelector('#admin-username').value = adminCredentials.username;
                form.querySelector('#admin-password').value = adminCredentials.password;
            }
        }
        
        // Listener para salvar Configura√ß√£o Global
        document.getElementById('global-config-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!isAdminLoggedIn || !db) { showModal("Acesso Negado", "Admin necess√°rio."); return; }
            
            const newConfig = {
                email: e.target.querySelector('#config-email').value.trim(),
                telefone: e.target.querySelector('#config-phone').value.trim(),
                instagram: e.target.querySelector('#config-instagram').value.trim(),
                mapsLink: e.target.querySelector('#config-maps-link').value.trim()
            };
            const newPresentationText = e.target.querySelector('#presentation-text-area').value.trim();

            try {
                // 1. Atualiza Configura√ß√£o P√∫blica
                const publicDocRef = doc(db, PUBLIC_CONFIG_DOC_PATH);
                await updateDoc(publicDocRef, newConfig);
                appConfig = newConfig; // Atualiza cache
                renderPublicConfig();
                
                // 2. Atualiza Texto de Apresenta√ß√£o (Status Doc)
                const statusDocRef = doc(db, APP_STATUS_DOC_PATH);
                await updateDoc(statusDocRef, { presentation_text: newPresentationText });
                
                showModal("Sucesso", "Configura√ß√µes Globais atualizadas!");
            } catch (error) {
                console.error("Erro ao salvar Configura√ß√£o Global:", error);
                showModal("Erro", `N√£o foi poss√≠vel salvar a configura√ß√£o. Detalhes: ${error.message}.`);
            }
        });

        // Listener para salvar Credenciais Admin
        document.getElementById('admin-credentials-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!isAdminLoggedIn || !db) { showModal("Acesso Negado", "Admin necess√°rio."); return; }

            const newCredentials = {
                username: e.target.querySelector('#admin-username').value.trim(),
                password: e.target.querySelector('#admin-password').value.trim()
            };
            
            if (newCredentials.username.length < 3 || newCredentials.password.length < 4) {
                showModal("Aten√ß√£o", "Usu√°rio e Senha devem ter no m√≠nimo 3 e 4 caracteres, respectivamente.");
                return;
            }

            try {
                const adminDocRef = doc(db, ADMIN_CONFIG_DOC_PATH);
                await updateDoc(adminDocRef, newCredentials);
                adminCredentials = newCredentials; // Atualiza cache
                showModal("Sucesso", "Credenciais de Admin atualizadas! Use a nova senha no pr√≥ximo login.");
            } catch (error) {
                console.error("Erro ao salvar Credenciais Admin:", error);
                showModal("Erro", `N√£o foi poss√≠vel salvar as credenciais. Detalhes: ${error.message}.`);
            }
        });


        // --- 10. Fun√ß√µes de Modal (Ajuda) ---

        /** Mostra um modal de Alerta/Info. */
        function showModal(title, message) {
            document.getElementById('alert-modal-title').textContent = title;
            document.getElementById('alert-modal-message').textContent = message;
            document.getElementById('alert-modal').classList.remove('hidden');
        }

        // Listener para fechar o modal de alerta
        document.getElementById('alert-modal-close').addEventListener('click', () => {
            document.getElementById('alert-modal').classList.add('hidden');
        });
        
        /** Mostra um modal de Confirma√ß√£o. */
        function showConfirmModal(title, message) {
            return new Promise(resolve => {
                const modal = document.getElementById('confirm-modal');
                const titleEl = document.getElementById('confirm-modal-title');
                const messageEl = document.getElementById('confirm-modal-message');
                const confirmBtn = document.getElementById('confirm-modal-yes');
                const cancelBtn = document.getElementById('confirm-modal-no');

                titleEl.textContent = title;
                messageEl.textContent = message;
                modal.classList.remove('hidden');

                const handleConfirm = () => {
                    modal.classList.add('hidden');
                    confirmBtn.removeEventListener('click', handleConfirm);
                    cancelBtn.removeEventListener('click', handleCancel);
                    resolve(true);
                };

                const handleCancel = () => {
                    modal.classList.add('hidden');
                    confirmBtn.removeEventListener('click', handleConfirm);
                    cancelBtn.removeEventListener('click', handleCancel);
                    resolve(false);
                };

                confirmBtn.addEventListener('click', handleConfirm);
                cancelBtn.addEventListener('click', handleCancel);
            });
        }


        // --- 11. INICIALIZA√á√ÉO DA APLICA√á√ÉO ---
        window.onload = initialAuthAndSetup;

    </script>
</head>
<body class="min-h-screen transition-colors duration-400">

    <div id="adoption-modal" class="hidden fixed inset-0 z-50 overflow-y-auto bg-gray-900 bg-opacity-70 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-lg w-full p-6 relative">
            <button id="adoption-modal-close" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>
            <h3 class="text-2xl font-bold text-rose-500 mb-4">Interesse em Ado√ß√£o</h3>
            <p class="text-gray-600 dark:text-gray-300 mb-4">Voc√™ est√° manifestando interesse em adotar: <span id="interest-animal-name" class="font-bold text-sky-500"></span>.</p>
            
            <form id="adoption-interest-form">
                <div class="mb-4">
                    <label for="interestName" class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-200">Seu Nome Completo *</label>
                    <input type="text" id="interestName" name="interestName" required class="input-style border border-gray-300 dark:border-gray-600 dark:bg-gray-700 w-full p-3 text-gray-900 dark:text-gray-100">
                </div>
                <div class="mb-4">
                    <label for="interestPhone" class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-200">Telefone para Contato (WhatsApp) *</label>
                    <input type="tel" id="interestPhone" name="interestPhone" required class="input-style border border-gray-300 dark:border-gray-600 dark:bg-gray-700 w-full p-3 text-gray-900 dark:text-gray-100">
                </div>
                <div class="mb-6">
                    <label for="interestEmail" class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-200">Email (Opcional)</label>
                    <input type="email" id="interestEmail" name="interestEmail" class="input-style border border-gray-300 dark:border-gray-600 dark:bg-gray-700 w-full p-3 text-gray-900 dark:text-gray-100">
                </div>

                <p id="adoption-interest-error" class="text-red-500 text-sm mb-4"></p>
                <button type="submit" class="w-full bg-sky-500 text-white py-3 rounded-lg font-bold hover:bg-sky-600 transition-colors shadow-md">
                    Enviar Interesse em Ado√ß√£o
                </button>
            </form>
        </div>
    </div>
    
    <div id="alert-modal" class="hidden fixed inset-0 z-50 overflow-y-auto bg-gray-900 bg-opacity-70 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-sm w-full p-6 relative">
            <h3 id="alert-modal-title" class="text-xl font-bold text-rose-500 mb-3">T√≠tulo</h3>
            <p id="alert-modal-message" class="text-gray-600 dark:text-gray-300 mb-5">Mensagem.</p>
            <button id="alert-modal-close" class="w-full bg-sky-500 text-white py-2 rounded-lg font-semibold hover:bg-sky-600 transition-colors">
                Entendi
            </button>
        </div>
    </div>

    <div id="confirm-modal" class="hidden fixed inset-0 z-50 overflow-y-auto bg-gray-900 bg-opacity-70 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-sm w-full p-6 relative">
            <h3 id="confirm-modal-title" class="text-xl font-bold text-rose-500 mb-3">Confirmar A√ß√£o</h3>
            <p id="confirm-modal-message" class="text-gray-600 dark:text-gray-300 mb-5">Tem certeza?</p>
            <div class="flex justify-end space-x-3">
                <button id="confirm-modal-no" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg font-semibold hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors text-gray-800 dark:text-gray-200">
                    Cancelar
                </button>
                <button id="confirm-modal-yes" class="px-4 py-2 bg-red-500 text-white rounded-lg font-semibold hover:bg-red-600 transition-colors">
                    Confirmar
                </button>
            </div>
        </div>
    </div>


    <header id="main-header" class="sticky top-0 z-30 bg-white dark:bg-gray-900 shadow-md backdrop-blur-sm bg-opacity-90 dark:bg-opacity-90 transition-colors duration-400">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center relative">
            <h1 class="text-3xl font-extrabold text-rose-500 flex items-center space-x-2">
                <i data-lucide="paw-print" class="w-8 h-8"></i>
                <span>S.O.S Viralatas</span>
            </h1>
            <nav class="flex items-center">
                <button id="theme-toggle" class="p-3 rounded-full transition-colors bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 shadow-lg">
                    <i data-lucide="moon" class="w-6 h-6"></i>
                </button>
                <button id="toggle-admin" class="p-3 rounded-full transition-colors ml-4 bg-rose-400 text-gray-800 hover:bg-rose-500 shadow-lg">
                    <i data-lucide="settings" class="w-6 h-6"></i>
                </button>
            </nav>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

        <section id="public-section">
            <div class="text-center mb-12 py-10 bg-sky-50 dark:bg-gray-800 rounded-2xl shadow-xl border-t-4 border-rose-400">
                <h2 class="text-5xl font-black text-sky-600 dark:text-sky-400 mb-4">Uma Segunda Chance de Amor üíñ</h2>
                <p id="presentation-text" class="text-xl text-gray-700 dark:text-gray-300 max-w-3xl mx-auto px-4">
                    Bem-vindos ao S.O.S Viralatas by Andrea! Nossa miss√£o √© dar uma segunda chance a c√£es e gatos resgatados, encontrando lares amorosos para eles.
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-16">
                <div class="text-center p-6 bg-white dark:bg-gray-900 rounded-xl shadow-lg border-l-4 border-rose-400 transform hover:scale-105 transition-transform duration-300">
                    <i data-lucide="home" class="w-10 h-10 mx-auto text-rose-500 mb-2"></i>
                    <p class="text-sm font-semibold text-gray-500 dark:text-gray-400">Resgatados no Total</p>
                    <p id="resgatados-count" class="text-4xl font-extrabold text-sky-600 dark:text-sky-400">0</p>
                </div>
                <div class="text-center p-6 bg-white dark:bg-gray-900 rounded-xl shadow-lg border-l-4 border-sky-400 transform hover:scale-105 transition-transform duration-300">
                    <i data-lucide="heart" class="w-10 h-10 mx-auto text-sky-500 mb-2"></i>
                    <p class="text-sm font-semibold text-gray-500 dark:text-gray-400">Ado√ß√µes de Sucesso</p>
                    <p id="adotados-count" class="text-4xl font-extrabold text-rose-600 dark:text-rose-400">0</p>
                </div>
                <div class="text-center p-6 bg-white dark:bg-gray-900 rounded-xl shadow-lg border-l-4 border-rose-400 transform hover:scale-105 transition-transform duration-300">
                    <i data-lucide="piggy-bank" class="w-10 h-10 mx-auto text-rose-500 mb-2"></i>
                    <p class="text-sm font-semibold text-gray-500 dark:text-gray-400">Aguardando Doa√ß√µes</p>
                    <p id="doacao-count" class="text-4xl font-extrabold text-sky-600 dark:text-sky-400">0</p>
                </div>
            </div>

            <h2 class="text-4xl font-bold text-gray-800 dark:text-gray-100 mb-8 border-b-2 border-rose-300 pb-2 flex items-center space-x-3">
                <i data-lucide="list-video" class="w-8 h-8 text-rose-500"></i>
                <span>Nossos Resgatados (Prontos para Ado√ß√£o)</span>
            </h2>
            
            <div id="animals-list-public" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10">
                <p class="text-center text-gray-500 dark:text-gray-400 p-4 col-span-full">Carregando animais...</p>
            </div>

            <div class="mt-20 bg-sky-50 dark:bg-gray-800 p-10 rounded-2xl shadow-2xl border border-sky-200 dark:border-sky-700">
                <h2 class="text-4xl font-bold text-sky-600 dark:text-sky-400 mb-6 flex items-center space-x-3">
                    <i data-lucide="send" class="w-8 h-8"></i>
                    <span>Fale Conosco</span>
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 text-lg text-gray-700 dark:text-gray-300">
                    <div>
                        <p class="font-semibold text-rose-500 mb-2">Email:</p>
                        <p id="contact-email" class="break-words">carregando@email.com</p>
                    </div>
                    <div>
                        <p class="font-semibold text-rose-500 mb-2">Telefone/WhatsApp:</p>
                        <p id="contact-phone">carregando...</p>
                    </div>
                    <div>
                        <p class="font-semibold text-rose-500 mb-2">Instagram:</p>
                        <a id="contact-instagram" href="#" target="_blank" class="text-sky-600 dark:text-sky-400 hover:underline">carregando...</a>
                    </div>
                    <div>
                        <p class="font-semibold text-rose-500 mb-2">Localiza√ß√£o:</p>
                        <a id="map-link" href="#" target="_blank" class="text-sky-600 dark:text-sky-400 hover:underline flex items-center space-x-2">
                            <i data-lucide="map-pin" class="w-5 h-5"></i>
                            <span>Ver no Mapa</span>
                        </a>
                    </div>
                </div>
            </div>
        </section>


        <section id="login-section" class="hidden min-h-[50vh] flex items-center justify-center">
            <div class="bg-white dark:bg-gray-800 p-8 md:p-12 rounded-xl shadow-2xl max-w-md w-full border-t-4 border-red-500">
                <h2 class="text-3xl font-bold text-red-500 mb-6 text-center">Acesso Administrativo</h2>
                <p class="text-gray-600 dark:text-gray-300 mb-6 text-center">Insira as credenciais para acessar o painel de gerenciamento.</p>

                <form id="admin-login-form">
                    <div class="mb-5">
                        <label for="username" class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-200">Usu√°rio</label>
                        <input type="text" id="username" name="username" required class="input-style border border-gray-300 dark:border-gray-600 dark:bg-gray-700 w-full p-3 text-gray-900 dark:text-gray-100" placeholder="admin">
                    </div>
                    <div class="mb-6">
                        <label for="password" class="block text-sm font-medium mb-2 text-gray-700 dark:text-gray-200">Senha</label>
                        <input type="password" id="password" name="password" required class="input-style border border-gray-300 dark:border-gray-600 dark:bg-gray-700 w-full p-3 text-gray-900 dark:text-gray-100" placeholder="1234">
                    </div>
                    <p id="login-error-message" class="text-red-500 text-sm mb-4 text-center"></p>
                    <button type="submit" class="w-full bg-red-500 text-white py-3 rounded-lg font-bold hover:bg-red-600 transition-colors shadow-md">
                        Entrar no Painel
                    </button>
                </form>
            </div>
        </section>

        <section id="admin-section" class="hidden">
            <div class="bg-white dark:bg-gray-900 p-6 rounded-2xl shadow-xl border-b-4 border-sky-500 mb-8">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-3xl font-bold text-sky-500">Painel de Administra√ß√£o</h2>
                    <button id="logout-admin" class="bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 px-4 py-2 rounded-lg font-semibold hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors flex items-center space-x-2 shadow-sm">
                        <i data-lucide="log-out" class="w-5 h-5"></i>
                        <span>Sair</span>
                    </button>
                </div>
                <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">
                    Gerencie animais, visualize interesses em ado√ß√£o e configure o site. User ID: <span id="current-user-id" class="font-mono text-xs bg-gray-100 dark:bg-gray-700 p-1 rounded">...</span>
                </p>

                <nav id="admin-nav" class="flex space-x-2 border-t border-gray-200 dark:border-gray-700 pt-4">
                    <button data-view="dashboard" class="px-4 py-2 rounded-lg font-semibold bg-sky-500 text-white transition-colors flex items-center space-x-2">
                        <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                        <span>Dashboard</span>
                    </button>
                    <button data-view="animals" class="px-4 py-2 rounded-lg font-semibold bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors flex items-center space-x-2">
                        <i data-lucide="dog" class="w-5 h-5"></i>
                        <span>Animais</span>
                    </button>
                    <button data-view="config" class="px-4 py-2 rounded-lg font-semibold bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors flex items-center space-x-2">
                        <i data-lucide="settings-2" class="w-5 h-5"></i>
                        <span>Configura√ß√µes</span>
                    </button>
                </nav>
            </div>

            <div id="admin-dashboard-block">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="p-6 bg-white dark:bg-gray-800 rounded-xl shadow-lg border-l-4 border-sky-400">
                        <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Visualiza√ß√µes do Site</p>
                        <p id="admin-views-count" class="text-3xl font-extrabold text-sky-600 dark:text-sky-400 mt-1">0</p>
                    </div>
                    <div class="p-6 bg-white dark:bg-gray-800 rounded-xl shadow-lg border-l-4 border-rose-400">
                        <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Animais Ativos para Ado√ß√£o</p>
                        <p id="admin-available-animals" class="text-3xl font-extrabold text-rose-600 dark:text-rose-400 mt-1">0</p>
                    </div>
                    <div class="p-6 bg-white dark:bg-gray-800 rounded-xl shadow-lg border-l-4 border-sky-400">
                        <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Interesses em Ado√ß√£o (Novos)</p>
                        <p id="interests-count" class="text-3xl font-extrabold text-sky-600 dark:text-sky-400 mt-1">0</p>
                    </div>
                </div>

                <h3 class="text-2xl font-bold text-gray-800 dark:text-gray-100 mb-4 border-b border-rose-200 dark:border-rose-700 pb-2 flex items-center space-x-2">
                    <i data-lucide="inbox" class="w-6 h-6 text-rose-500"></i>
                    <span>Interessados em Ado√ß√£o</span>
                </h3>
                <ul id="adoption-interests-list" class="space-y-3">
                    <p class="text-center text-gray-500 dark:text-gray-400 p-4">Carregando lista de interesses...</p>
                </ul>
            </div>

            <div id="admin-animals-block" class="hidden">
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg mb-8">
                    <h3 id="animal-form-title" class="text-2xl font-bold text-sky-500 mb-4 border-b border-sky-200 dark:border-sky-700 pb-2">Adicionar Novo Animal</h3>
                    
                    <form id="animal-form" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label for="nome" class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-200">Nome</label>
                                <input type="text" id="nome" name="nome" required class="input-style border border-gray-300 dark:border-gray-600 dark:bg-gray-700 w-full p-2 text-gray-900 dark:text-gray-100">
                            </div>
                            <div>
                                <label for="raca" class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-200">Ra√ßa / Tipo</label>
                                <input type="text" id="raca" name="raca" required class="input-style border border-gray-300 dark:border-gray-600 dark:bg-gray-700 w-full p-2 text-gray-900 dark:text-gray-100">
                            </div>
                            <div>
                                <label for="idade" class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-200">Idade (Anos)</label>
                                <input type="number" id="idade" name="idade" required class="input-style border border-gray-300 dark:border-gray-600 dark:bg-gray-700 w-full p-2 text-gray-900 dark:text-gray-100" min="0" value="1">
                            </div>
                        </div>
                        <div>
                            <label for="imagemUrl" class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-200">URL da Imagem</label>
                            <input type="url" id="imagemUrl" name="imagemUrl" class="input-style border border-gray-300 dark:border-gray-600 dark:bg-gray-700 w-full p-2 text-gray-900 dark:text-gray-100" placeholder="http://exemplo.com/foto.jpg">
                        </div>
                        <div>
                            <label for="descricao" class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-200">Descri√ß√£o/Hist√≥ria</label>
                            <textarea id="descricao" name="descricao" rows="3" required class="input-style border border-gray-300 dark:border-gray-600 dark:bg-gray-700 w-full p-2 text-gray-900 dark:text-gray-100"></textarea>
                        </div>

                        <div class="flex space-x-4">
                            <button type="submit" id="submit-animal-btn" class="bg-rose-500 text-white py-2 px-4 rounded-lg font-bold hover:bg-rose-600 transition-colors shadow-md flex-grow">
                                Adicionar ao Resgate
                            </button>
                            <button type="button" id="cancel-edit-btn" class="hidden bg-gray-400 text-white py-2 px-4 rounded-lg font-bold hover:bg-gray-500 transition-colors shadow-md">
                                Cancelar Edi√ß√£o
                            </button>
                        </div>
                    </form>
                </div>

                <h3 class="text-2xl font-bold text-gray-800 dark:text-gray-100 mb-4 border-b border-rose-200 dark:border-rose-700 pb-2 flex items-center space-x-2">
                    <i data-lucide="clipboard-list" class="w-6 h-6 text-rose-500"></i>
                    <span>Lista de Animais Cadastrados</span>
                </h3>
                <ul id="animals-list-admin" class="space-y-4">
                    <p class="text-center text-gray-500 dark:text-gray-400 p-4">Carregando lista de animais...</p>
                </ul>
            </div>

            <div id="admin-config-block" class="hidden grid grid-cols-1 lg:grid-cols-2 gap-8">
                
                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                    <h3 class="text-2xl font-bold text-sky-500 mb-4 border-b border-sky-200 dark:border-sky-700 pb-2 flex items-center space-x-2">
                        <i data-lucide="globe" class="w-6 h-6"></i>
                        <span>Configura√ß√µes P√∫blicas e Contatos</span>
                    </h3>
                    <form id="global-config-form" class="space-y-4">
                        <div class="mb-4">
                            <label for="presentation-text-area" class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-200">Texto de Apresenta√ß√£o</label>
                            <textarea id="presentation-text-area" rows="3" class="input-style border border-gray-300 dark:border-gray-600 dark:bg-gray-700 w-full p-2 text-gray-900 dark:text-gray-100"></textarea>
                        </div>
                        <div>
                            <label for="config-email" class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-200">Email de Contato</label>
                            <input type="email" id="config-email" class="input-style border border-gray-300 dark:border-gray-600 dark:bg-gray-700 w-full p-2 text-gray-900 dark:text-gray-100">
                        </div>
                        <div>
                            <label for="config-phone" class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-200">Telefone/WhatsApp</label>
                            <input type="text" id="config-phone" class="input-style border border-gray-300 dark:border-gray-600 dark:bg-gray-700 w-full p-2 text-gray-900 dark:text-gray-100">
                        </div>
                        <div>
                            <label for="config-instagram" class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-200">Instagram (@)</label>
                            <input type="text" id="config-instagram" class="input-style border border-gray-300 dark:border-gray-600 dark:bg-gray-700 w-full p-2 text-gray-900 dark:text-gray-100">
                        </div>
                        <div>
                            <label for="config-maps-link" class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-200">Link do Google Maps</label>
                            <input type="url" id="config-maps-link" class="input-style border border-gray-300 dark:border-gray-600 dark:bg-gray-700 w-full p-2 text-gray-900 dark:text-gray-100">
                        </div>
                        <button type="submit" class="w-full bg-rose-500 text-white py-2 rounded-lg font-bold hover:bg-rose-600 transition-colors shadow-md">
                            Salvar Configura√ß√µes P√∫blicas
                        </button>
                    </form>
                </div>

                <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg">
                    <h3 class="text-2xl font-bold text-red-500 mb-4 border-b border-red-200 dark:border-red-700 pb-2 flex items-center space-x-2">
                        <i data-lucide="lock" class="w-6 h-6"></i>
                        <span>Credenciais de Acesso Admin</span>
                    </h3>
                    <p class="text-sm text-red-400 mb-4">Mude seu usu√°rio e senha de login aqui. **Cuidado ao salvar**.</p>
                    <form id="admin-credentials-form" class="space-y-4">
                        <div>
                            <label for="admin-username" class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-200">Novo Usu√°rio Admin</label>
                            <input type="text" id="admin-username" required class="input-style border border-gray-300 dark:border-gray-600 dark:bg-gray-700 w-full p-2 text-gray-900 dark:text-gray-100">
                        </div>
                        <div>
                            <label for="admin-password" class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-200">Nova Senha Admin</label>
                            <input type="password" id="admin-password" required class="input-style border border-gray-300 dark:border-gray-600 dark:bg-gray-700 w-full p-2 text-gray-900 dark:text-gray-100">
                        </div>
                        <button type="submit" class="w-full bg-red-500 text-white py-2 rounded-lg font-bold hover:bg-red-600 transition-colors shadow-md">
                            Atualizar Credenciais
                        </button>
                    </form>
                    
                    <h3 class="text-2xl font-bold text-sky-500 mt-8 mb-4 border-b border-sky-200 dark:border-sky-700 pb-2 flex items-center space-x-2">
                        <i data-lucide="bar-chart-2" class="w-6 h-6"></i>
                        <span>Contadores Gerenciados</span>
                    </h3>
                    <p class="text-sm text-gray-600 dark:text-gray-300 mb-4">Use para ajustar o total de resgatados e adotados no site p√∫blico.</p>
                    
                    <form id="managed-counters-form" class="space-y-4">
                         <div>
                            <label for="resgatados" class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-200">Total Resgatados</label>
                            <input type="number" id="resgatados" required class="input-style border border-gray-300 dark:border-gray-600 dark:bg-gray-700 w-full p-2 text-gray-900 dark:text-gray-100" min="0">
                        </div>
                        <div>
                            <label for="adotados" class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-200">Total Adotados</label>
                            <input type="number" id="adotados" required class="input-style border border-gray-300 dark:border-gray-600 dark:bg-gray-700 w-full p-2 text-gray-900 dark:text-gray-100" min="0">
                        </div>
                        <div>
                            <label for="aguardando" class="block text-sm font-medium mb-1 text-gray-700 dark:text-gray-200">Aguardando Doa√ß√£o (Contagem Manual)</label>
                            <input type="number" id="aguardando" required class="input-style border border-gray-300 dark:border-gray-600 dark:bg-gray-700 w-full p-2 text-gray-900 dark:text-gray-100" min="0">
                        </div>
                        <button type="submit" class="w-full bg-sky-500 text-white py-2 rounded-lg font-bold hover:bg-sky-600 transition-colors shadow-md">
                            Atualizar Contadores
                        </button>
                    </form>
                </div>
                
            </div>
            
        </section>

    </main>
    
    <footer class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 text-center text-sm text-gray-500 dark:text-gray-400 border-t border-gray-200 dark:border-gray-700 mt-10">
        &copy; 2024 S.O.S Viralatas by Andrea.
    </footer>

</body>
</html>
